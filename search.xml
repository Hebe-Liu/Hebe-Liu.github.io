<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Setup A Redis Cluster On Centos 7]]></title>
    <url>%2F2019%2F05%2F19%2FRedis%2F</url>
    <content type="text"><![CDATA[… PrerequisitesTree machines, each of them has one master, one slave and one sentinel. 172.19.226.208: 6383 6384172.19.226.209: 6385 6385172.19.226.210: 6387 6388 RedisTCP ports12345firewall-cmd --permanent --new-zone=redisfirewall-cmd --permanent --zone=redis --add-port=6383/tcpfirewall-cmd --permanent --zone=redis --add-port=16383/tcpfirewall-cmd --permanent --zone=redis --add-source=client_server_private_IPfirewall-cmd --reload Install Redis1234wget http://download.redis.io/releases/redis-4.0.14.tar.gztar -zxvf redis-4.0.14.tar.gzcd redis-4.0.14make &amp; make install Setup required directories1234567cp redis.conf /usr/local/bincp sentinel.conf /usr/local/bincp src/redis-trib.rb /usr/local/bincd /usr/local/binmkdir redisdata redislogcp redis.conf 6383.confmv redis.conf 6384.conf Configure RedisHere is “6383.conf” file. Notice that port and bind values will be different for each node.12345678910111213141516171819202122232425262728293031323334# Bind your public/local ip, to let you access by your ip address bind 172.19.226.208# Let clients from other hosts to connect to Redisprotected-mode no# Specify redis instance portport 6383# Run as background servicedaemonize yes# For daemonized pid file pathpidfile /var/run/redis_6383.pid# Specify log file pathlogfile &quot;/usr/local/bin/redislog/6383.log&quot;# Specify db dump pathdbfilename 6383.rdb# db will written into this directorydir /usr/local/bin/redisdata# Load data from AOF fileappendonly yesappendfilename &quot;6383.aof&quot;# Enables the cluster modecluster-enabled yescluster-config-file nodes-6383.conf# For it to be considered in failure statecluster-node-timeout 5000 Start Redis1redis-server /usr/local/bin/6383.conf Redis client123redis-cli -h 172.19.226.208 -p 6383&gt;ping&gt;SHUTDOWN Redis ClusterInstall Ruby12345yum install centos-release-scl-rhyum install rh-ruby25 -yscl enable rh-ruby25 bashruby -vgem install redis Set environment variablesAdding the output of command “export” to the bottom of /etc/profile.123exportvim /etc/profilesource /etc/profile Creating the cluster1redis-trib.rb create --replicas 1 172.19.226.208:6383 172.19.226.209:7003 172.19.226.210:7005 172.19.226.208:6384 172.19.226.209:7004 172.19.226.210:7006 Redis Sentinel12mv sentinel.conf 26383.confvim 26383.conf Configure Redis12port 26383sentinel monitor mymaster 172.19.226.208 6383 2 Start sentinel1redis-sentinel /usr/local/bin/26383.conf &amp; ERROR [ERR] Node 172.19.226.208:6383 is not empty. Either the node already knows other nodes (check with CLUSTER NODES) or contains some key in database 0. To wipe the node clean:123456cd redisdatarm -f *redis-cli -h 172.19.226.208 -p 6383&gt;flushall&gt;cluster reset&gt;exit Waiting for the cluster to join….. Make sure that not just the TCP listening port for the clients, but also the Cluster Bus port, is open. The Cluster bus port is always the Redis base port + 10000.123firewall-cmd --permanent --zone=redis--add-port=16383/tcpfirewall-cmd --permanent --zone=redis--add-port=16384/tcpfirewall-cmd --reload]]></content>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
</search>
